<h2>카테고리 정보</h2>
{% if category %}

<h2>category list for {{category.author}}</h2>

<table class="table table-bordered" id="todo_list">
    {% for ca  in column_list %}
    <tr id="ca{{forloop.counter}}">
        <td>ca{{forloop.counter}}</td>
         <td>
            <input
                type="text"
                name=""
                id="input_category_nick"
                value="{{ca}}"
                class="form-control"
            />
        </td>
        <td>
            {% if category.author == request.user %}
            <a
                class="btn btn-outline-primary btn-sm cn-btn"
                data-id="{{category.id}}"
                data-field="ca{{forloop.counter}}"
                >수정</a
            >
            {% endif %}
            <a
                class="btn btn-outline-primary btn-sm"
                href="/wm/myshortcut/{{page_user}}/{{forloop.counter}}"
                >이동</a
            >
        </td> 
    </tr>
    {% endfor %}

</table>

{% else %}

<table class="table table-borderd">
    <tr>
        <td>카테고리 정보가 없습니다.</td>
    </tr>
</table>

{% endif %}

<!-- modal area -->
<!-- js -->

<script type="text/javascript">
    $(".copyforNickSubjectBtn").click(function (e) {
        const author = $(this).data("author");
        const original_category = $(this).data("category");
        // alert("author : "+ author);
        // alert("category : "+ category);

        var destination_category = prompt(
            "어디로 복사 하시겠습니까? (1~99)",
            ""
        );

        if (destination_category.match("^[1-9][0-9]?$")) {
            window.history.pushState("", "", "/wm/myshortcut/");

            $.ajax({
                type: "POST",
                url: "copyForCategorySubjectToMyCategory/",
                data: {
                    author: author,
                    original_category: original_category,
                    destination_category: destination_category,
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                },
                success: function (result) {
                    alert(
                        author +
                            "의 " +
                            original_category +
                            "에서 나의 " +
                            destination_category +
                            "로 복사(기존 내용 삭제)"
                    );
                },
            });
        } else {
            alert("이동할 카테고리는 1~99 중에 선택해주세요");
        }
    });

    $(".cn-btn").click(function (e) {
        // alert("클릭");
        const ca_id = $(this).data("id");
        const field = $(this).data("field");
        const ca_nick_update = $(this)
            .parent()
            .parent()
            .find("#input_category_nick")
            .val();

        // alert("ca_id : " + ca_id)
        // alert("field : " + field);
        // alert("ca_nick_update : " + ca_nick_update);

        window.history.pushState("", "", "/wm/myshortcut/");

        $.ajax({
            type: "POST",
            url: "update/category/nick/",
            data: {
                ca_id: ca_id,
                field: field,
                ca_nick_update: ca_nick_update,
                csrfmiddlewaretoken: "{{ csrf_token }}",
            },
            success: function (result) {
                // alert("category nick update success")
                alert("result.message : " + result.message);
                // 이동한후 목록 버튼 클릭하도록 설정
                // $(location). attr('href', 'http://127.0.0.1:7000/wm/myshortcut/');
            },
        });
    });
</script>
